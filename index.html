<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <base target="_top">

  <!-- ✅ Correct viewport (prevents iOS weird scaling + supports safe-area) -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">

  <title>NASCAR Pool 2026</title>

  <script>
    // Some earlier code...
    async function loadDues() {
      const sel = document.getElementById("duesName");
      const out = document.getElementById("duesStatus");

      const name = sel ? String(sel.value || "").trim() : "";
      if (!name) { out.textContent = "Pick your name first."; return; }

      savePlayerName(name);
      out.textContent = "Loading…";

      try{
        const all = await getData_("dues", "playerGetDues", { name });

        // dues.json might be:
        // - a single object (already filtered)
        // - an object keyed by player name
        // - an array of rows/objects
        let data = null;

        if(all && typeof all === "object" && !Array.isArray(all) && (all.name || all.paid != null || all.balance != null)){
          data = all; // already a single record
        } else if(all && typeof all === "object" && !Array.isArray(all) && all[name]){
          data = all[name];
        } else if(Array.isArray(all)){
          data = all.find(r => String(r?.name || "").trim().toLowerCase() === name.toLowerCase()) || null;
        } else if(all && Array.isArray(all.dues)){
          data = all.dues.find(r => String(r?.name || "").trim().toLowerCase() === name.toLowerCase()) || null;
        }

        if(!data) throw new Error("No dues record found for " + name);

        const winnings = Number(data.paid || 0) - Number(data.balance || 0);

        out.textContent =
          `${data.name || name}\nPaid: $${Number(data.paid || 0).toFixed(2)}\nWinnings: $${winnings.toFixed(2)}\nBalance Due: $${Number(data.balance || 0).toFixed(2)}`;
      }catch(e){
        out.textContent = "Error: " + (e && e.message ? e.message : e);
      }
    }

    // Other existing code...
  </script>
</head>
<body>
  <h2>NASCAR Pool 2026</h2>
  ...
</body>
</html>